<!DOCTYPE html>
<html lang="en">
<head>
    <title>Pack Fire</title>
    <meta property="og:description" content="Your Guide to the 2026 Solar Eclipse." />
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.6.2/dist/maplibre-gl.css' />
    <script src='https://unpkg.com/maplibre-gl@5.6.2/dist/maplibre-gl.js'></script>
    <script src="https://unpkg.com/@maplibre/maplibre-gl-geocoder@1.5.0/dist/maplibre-gl-geocoder.min.js"></script>
    <link
        rel="stylesheet"
        href="https://unpkg.com/@maplibre/maplibre-gl-geocoder@1.5.0/dist/maplibre-gl-geocoder.css"
    />
    <style>
        body { margin: 0; padding: 0; }
        html, body, #map { height: 100%; }
    </style>
</head>
<style>
    #map {
        background: #000;
    }
</style>
<body>
<div id="map"></div>
<script>
    const source = 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json';
    const map = new maplibregl.Map({
        container: 'map',
        style: source,
        zoom: 10,
        center: [-118.7523402087362, 37.60485913533001],
    });
    map.on('load', () => {
        fetch('https://services.arcgis.com/BLN4oKB0N1YSgvY8/arcgis/rest/services/CA_EVACUATIONS_CalOESHosted_view/FeatureServer/0/query?where=1%3D1&outFields=*&f=geojson')
        .then(response => response.json())
        .then(data => {
            map.addSource('evacuations', {
                type: 'geojson',
                data: data
            });
            map.addLayer({
                id: 'evacuations-layer',
                type: 'fill',
                source: 'evacuations',
                paint: {
                    'fill-color': [
                    'match',
                    ['get', 'STATUS'],     // <-- field name from your data
                    'Evacuation Order', '#ff0000',    // red
                    'Evacuation Warning', '#FFA500',  // orange
                    /* default */ '#999999'
                ],
                    'fill-opacity': 0.1
                }
            });
            map.addLayer({
                id: 'evacuations-outline-layer',
                type: 'line',
                source: 'evacuations',
                paint: {
                    'line-color': [
                    'match',
                    ['get', 'STATUS'],     // <-- field name from your data
                    'Evacuation Order', '#ff0000',    // darker red
                    'Evacuation Warning', '#FFA500',  // dark orange
                    /* default */ '#999999'
                ],
                    'line-width': 2
                }
            });
        });
    });
    const geocoderApi = {
        forwardGeocode: async (config) => {
            const features = [];
            try {
                const request =
            `https://nominatim.openstreetmap.org/search?q=${
                config.query
            }&format=geojson&polygon_geojson=1&addressdetails=1`;
                const response = await fetch(request);
                const geojson = await response.json();
                for (const feature of geojson.features) {
                    const center = [
                        feature.bbox[0] +
                    (feature.bbox[2] - feature.bbox[0]) / 2,
                        feature.bbox[1] +
                    (feature.bbox[3] - feature.bbox[1]) / 2
                    ];
                    const point = {
                        type: 'Feature',
                        geometry: {
                            type: 'Point',
                            coordinates: center
                        },
                        place_name: feature.properties.display_name,
                        properties: feature.properties,
                        text: feature.properties.display_name,
                        place_type: ['place'],
                        center
                    };
                    features.push(point);
                }
            } catch (e) {
                console.error(`Failed to forwardGeocode with error: ${e}`);
            }
            return {
                features
            };
        }
    };
    map.addControl(
        new MaplibreGeocoder(geocoderApi, {
            maplibregl
        })
    );
</script>
</body>
</html>